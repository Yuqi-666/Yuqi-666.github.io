{{- /* A Hugo Markdown render hook to parse links:
1. Open external links in new tabs
2. Remove index.md/_index.md suffix from internal links (修复下划线残留问题) */ -}}

{{- $destination := .Destination -}}

{{- /* 修复逻辑：先处理 _index.md（更长的后缀），再处理 index.md，避免残留下划线 */ -}}
{{- $destination = strings.TrimSuffix "_index.md" $destination -}}
{{- $destination = strings.TrimSuffix "index.md" $destination -}}

{{- /* 额外处理：如果路径末尾只剩下划线（极端情况），直接去除 */ -}}
{{- $destination = strings.TrimSuffix "_" $destination -}}

<a 
  href="{{ $destination | safeURL }}"
  {{- with .Title}} title="{{ . }}"{{ end }}
  {{- if strings.HasPrefix $destination "http" }} target="_blank" rel="noopener"{{ end }}
>
  {{- .Text | safeHTML -}}
</a>